![image](https://github.com/user-attachments/assets/b614685b-5456-4cc4-a5d5-49aa5812dae6)
![image](https://github.com/user-attachments/assets/815a00ee-bc65-4184-8b77-20afd76b6110)
# ğŸ” Spring Security Filter Chain ì„¤ëª…

Spring Securityì˜ ì¸ì¦ íë¦„ì€ ë‹¤ì–‘í•œ í•„í„°ë¡œ êµ¬ì„±ëœ `Security Filter Chain`ì„ í†µí•´ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” ê·¸ íë¦„ì„ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

---

## ğŸ“Š ì „ì²´ íë¦„ ìš”ì•½

ìš”ì²­ â†’ SecurityContextPersistenceFilter
â†’ CsrfFilter
â†’ UsernamePasswordAuthenticationFilter
â†’ AuthenticationManager
â†’ AuthenticationProvider
â†’ UserDetailsService
â†’ AccountRepository


---

## 1ï¸âƒ£ SecurityContextPersistenceFilter

- í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ **ê°€ì¥ ë¨¼ì € ë™ì‘**í•˜ëŠ” í•„í„°.
- ê¸°ì¡´ ì„¸ì…˜ì— ì €ì¥ëœ `SecurityContext`ê°€ ìˆë‹¤ë©´ êº¼ë‚´ì„œ `SecurityContextHolder`ì— ì €ì¥í•¨.
- ì—†ìœ¼ë©´ ë‹¤ìŒ í•„í„°ë¡œ ì§„í–‰.
- ğŸ” ë‚´ë¶€ì ìœ¼ë¡œ `SecurityContextRepository`ì™€ ìƒí˜¸ì‘ìš©í•˜ì—¬ ì¸ì¦ ì •ë³´ ì¡´ì¬ ì—¬ë¶€ í™•ì¸.

---

## 2ï¸âƒ£ SecurityContextRepository

- ì‚¬ìš©ìì˜ `SecurityContext`(ì¸ì¦ ì •ë³´)ê°€ **ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€** í™•ì¸í•˜ëŠ” ì €ì¥ì†Œ.
- ì¡´ì¬í•˜ë©´ ì¸ì¦ ì²˜ë¦¬ ìƒëµ ê°€ëŠ¥.

---

## 3ï¸âƒ£ CsrfFilter

- **CSRF ê³µê²© ë°©ì§€**ë¥¼ ìœ„í•œ í•„í„°.
- POST, PUT, DELETE ìš”ì²­ì— ëŒ€í•´ **CSRF í† í° ê²€ì¦** ìˆ˜í–‰.
- í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ìš”ì²­ì€ ì°¨ë‹¨ë¨.

---

## 4ï¸âƒ£ UsernamePasswordAuthenticationFilter

- **ë¡œê·¸ì¸ ìš”ì²­ ì²˜ë¦¬ í•„í„°** (`/login`)
- ì‚¬ìš©ìê°€ ì…ë ¥í•œ `username`ê³¼ `password`ë¥¼ `AuthenticationManager`ì— ì „ë‹¬í•˜ì—¬ ì¸ì¦ ì‹œë„.

---

## 5ï¸âƒ£ AuthenticationManager (ProviderManager)

- ì¸ì¦ ì²˜ë¦¬ì˜ **ì¤‘ì•™ ê´€ë¦¬ì**.
- ì ì ˆí•œ `AuthenticationProvider`ë¥¼ ì„ íƒí•˜ì—¬ `authenticate()` í˜¸ì¶œ.
- ì§ì ‘ ì¸ì¦ì„ í•˜ì§€ ì•Šê³  ìœ„ì„ë§Œ ìˆ˜í–‰í•¨.

---

## 6ï¸âƒ£ AuthenticationProvider (DaoAuthenticationProvider)

- ì‹¤ì œ ì¸ì¦ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤.
- ì „ë‹¬ë°›ì€ ì‚¬ìš©ìëª…ì„ ì´ìš©í•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒ.
- ë‚´ë¶€ì—ì„œ `UserDetailsService`ì˜ `loadUserByUsername()` ë©”ì„œë“œ í˜¸ì¶œ.

---

## 7ï¸âƒ£ UserDetailsService (ì˜ˆ: AccountService)

- ì‚¬ìš©ì ì •ë³´ë¥¼ **DB ë˜ëŠ” ì €ì¥ì†Œì—ì„œ ë¡œë“œ**í•˜ëŠ” ì„œë¹„ìŠ¤.
- ì‚¬ìš©ìëª…ì´ ì¡´ì¬í•˜ë©´ `UserDetails` ê°ì²´ ë°˜í™˜.
- ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ `UsernameNotFoundException` ë°œìƒ.

---

## 8ï¸âƒ£ AccountRepository

- `UserDetailsService`ê°€ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ê¸° ìœ„í•´ í˜¸ì¶œí•˜ëŠ” DB ë ˆì´ì–´.
- ì¼ë°˜ì ìœ¼ë¡œ `findByUsername()` ë©”ì„œë“œ ì‚¬ìš©.

---

## âœ… ì •ë¦¬

| êµ¬ì„± ìš”ì†Œ                          | ì—­í•  ì„¤ëª… |
|-----------------------------------|-----------|
| `SecurityContextPersistenceFilter` | ìš”ì²­ ì‹œì‘ ì‹œ ê¸°ì¡´ ì¸ì¦ì •ë³´ ë¡œë“œ |
| `SecurityContextRepository`        | ì¸ì¦ì •ë³´ê°€ ìˆëŠ”ì§€ í™•ì¸ |
| `CsrfFilter`                       | CSRF ê³µê²© ë°©ì§€ |
| `UsernamePasswordAuthenticationFilter` | ë¡œê·¸ì¸ ì²˜ë¦¬ í•„í„° |
| `AuthenticationManager`           | ì¸ì¦ ì²˜ë¦¬ ìœ„ì„ ê´€ë¦¬ì |
| `AuthenticationProvider`          | ì‹¤ì œ ì¸ì¦ ìˆ˜í–‰ì |
| `UserDetailsService`              | ì‚¬ìš©ì ì •ë³´ ë¡œë”© |
| `AccountRepository`               | DB ì¡°íšŒ ìˆ˜í–‰ì |

---

## ğŸ›  ì‹¤ë¬´ íŒ

- ì´ íë¦„ì€ `formLogin()` ì„¤ì • ì‹œ ì‚¬ìš©ë˜ëŠ” ê¸°ë³¸ ì¸ì¦ ì ˆì°¨ì…ë‹ˆë‹¤.
- JWTë‚˜ OAuth2 ê¸°ë°˜ ì¸ì¦ì„ ì‚¬ìš©í•  ê²½ìš° í•„í„° êµ¬ì„±ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ í•„ìš”í•˜ë©´:
  - `UserDetailsService`ë¥¼ ì¬ì •ì˜í•˜ì—¬ ì‚¬ìš©ì ë¡œë”© ë¡œì§ ìˆ˜ì •
  - `AuthenticationProvider` ë˜ëŠ” `Filter`ë¥¼ ì§ì ‘ êµ¬í˜„í•˜ì—¬ í™•ì¥ ê°€ëŠ¥

